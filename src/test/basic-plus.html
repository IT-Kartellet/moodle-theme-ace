<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Force latest IE rendering engine or ChromeFrame if installed -->
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><![endif]-->
<meta charset="utf-8">
<title>jQuery File Upload Demo - Basic Plus version</title>
<!-- Bootstrap styles -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<!-- Generic page styles -->
<link rel="stylesheet" href="css/style.css">
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="css/jquery.fileupload.css">
</head>
<body>
<div class="container">
    <!-- The fileinput-button span is used to style the file input field as button -->
    <span class="btn btn-success fileinput-button">
        <i class="glyphicon glyphicon-plus"></i>
        <span>Add files...</span>
        <!-- The file input field used as target for the file upload widget -->
        <input id="fileupload" type="file" name="files[]" multiple>
    </span>
    <div id="files" class="files" style="margin-top: 5px;"></div>
    <textarea id="thumbs"></textarea>
    <div style="clear: left;">
        <button id="done_button" name="done_button">Done</button>
    </div>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="../javascript/jquery/jquery.ui.widget.js"></script>
<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Load-Image/js/load-image.min.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="http://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
<!-- Bootstrap JS is not required, but included for the responsive demo navigation -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="../javascript/jquery/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="../javascript/jquery/jquery.fileupload.js"></script>
<!-- The File Upload processing plugin -->
<script src="../javascript/jquery/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="../javascript/jquery/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="../javascript/jquery/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="../javascript/jquery/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="../javascript/jquery/jquery.fileupload-validate.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script>
$(function () {
    'use strict';
    // Change this to the location of your server-side upload handler:
    var url = "/theme/ace/fileupload.php",
        uploadError = function(context) {
            var errorDiv = $("<div />").html("ERROR").css({'textAlign': 'center', width: '100px', marginTop: "40px"});
            $(context).css({backgroundColor: '#B00000', color: '#FFFFFF', fontWeight: 'bold',
                            width: '100px', height: '100px'})
                      .html('')
                      .append(errorDiv);

            // Hide error in 2 seconds
            setTimeout(function () {
                $(context).remove();
            }, 2000);
        }
    $('#fileupload').fileupload({
        url: url,
        dataType: 'json',
        autoUpload: false,
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 5000000, // 5 MB
        // Enable image resizing, except for Android and Opera,
        // which actually support image resizing, but fail to
        // send Blob objects via XHR requests:
        disableImageResize: /Android(?!.*Chrome)|Opera/
            .test(window.navigator.userAgent),
        previewMaxWidth: 100,
        previewMaxHeight: 100,
        previewCrop: true
    }).on('fileuploadadd', function (e, data) {
        $.each(data.files, function (index, file) {
            data.context = $('<div />').css({float: 'left', height: '100px;', width: '100px;', position: 'relative',
                backgroundColor: '#EBEBEB', margin: '0 5px 5px 0'}).appendTo('#files');

            var file = data.files[index];
            data.context.text(file.preview);
        });
    }).on('fileuploadprocessalways', function (e, data) {
        var index = data.index,
            file = data.files[index];
        if (file.preview) {
            data.context.append(file.preview);
        }

        if (file.error) {
            uploadError(data.context);

            // Hide error in 2 seconds
            setTimeout(function () {
                $(data.context).remove();
            }, 2000);
        } else {
            var rm = $('<button/>').text('x')
                        .css({textAlign: 'center', fontWeight: 'bold', backgroundColor: '#000000',
                              color: "#FFFFFF", display: 'block', width: '20px', height: '20px',
                              position: 'absolute', top: 0, right: 0, border: 0})
                        .on('click', function () {
                            var $this = $(this);

                            $this.parent().remove();
                        });
            data.context.append(rm);
            data.submit();
        }
    }).on('fileuploaddone', function (e, data) {
        if (data.result.length) {
            $.each(data.result, function (index, file64) {
                if (!file64) {
                    uploadError(data.context);
                } else {
                    var hidden64 = $("<input />").attr({type: "hidden", value: file64});
                    $(data.context).css({cursor: "pointer"}).append(hidden64);

                    $( "#files" ).sortable();
                    $( "#files" ).disableSelection();
                }
            });
        } else {
            uploadError(data.context);
        }
    }).on('fileuploadfail', function (e, data) {
        $.each(data.files, function (index, file) {
            uploadError(data.context);
        });
    }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined : 'disabled');

    $("#done_button").on("click", function() {
        var thumbs = "";

        $("#thumbs").val("");
        $( "#files div input").each(function (id, image) {
            var image = $(image).val();
            if ($("#thumbs").val()) {
                $("#thumbs").val($("#thumbs").val()+","+image+"");
            } else {
                $("#thumbs").val(""+image+"");
            }
        });

        $("#thumbs").val(thumbs);
    });
});
</script>
</body> 
</html>
